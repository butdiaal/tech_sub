create database tech_sub;

use tech_sub;

create table departments(
    department_id int primary key auto_increment,
    name varchar(255)
);

create table user(
    user_id int primary key auto_increment,
    name varchar(255),
    last_name varchar(255),
    login varchar(255) unique,
    password varchar(255),
    ph_num varchar(255) unique
);

create table employees(
    employee_id int primary key auto_increment,
    name varchar(255),
    last_name varchar(255),
    login varchar(255) unique,
    password varchar(255),
    department_id int,
    foreign key (department_id) references departments(department_id) on delete set null
);

create table categorys(
    category_id int primary key auto_increment,
    name enum(1, 2, 3, 4, 5),
    level int
);

create table tickets(
    ticket_id int primary key auto_increment,
    category_id int,
    foreign key (category_id) references categorys(category_id) on delete set null,
    description varchar(255),
    status enum("в ожидании", "в работе", "решена"),
    employee_id int,
    foreign key (employee_id) references employees(employee_id) on delete set null,
    creation_date datetime,
    user_id int,
    foreign key (user_id) references user(user_id) on delete set null
);

create table history(
    history_id int primary key auto_increment,
    message varchar(255),
    datetime_mes datetime
);

create table reports(
    report_id int primary key auto_increment,
    ticket_id int,
    foreign key (ticket_id) references tickets(ticket_id) on delete set null,
    category_id int,
    foreign key (category_id) references categorys(category_id) on delete set null,
    description varchar(255),
    start_at datetime,
    finish_at datetime,
    name_last_name varchar(255)
);
